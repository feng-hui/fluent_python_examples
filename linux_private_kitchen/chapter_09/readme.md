#### 9、vim程序编辑器

##### 9.1、vi与vim

（1）为什么要学习vim?

* 所有的Unix Like系统都会内建vi文本编辑器，其他的文本编辑器不一定存在；
* 有很多软件的编辑接口都会主动调用vi（例如：crontab、visudo、edquota等）；
* vim具有程序编辑的能力，可以主动地以字体颜色辨别语法地正确性，方便程序设计；
* 程序简单，编辑相当快速。

**可以将vim视为vi的进阶版本。**

##### 9.2、vi的使用

（1）vi的三种模式

* 一般指令模式（command mode）：以vi打开一个文件称为一般指令模式（默认模式），可以使用[上下左右]按键来移动光标、可以删除字符或删除整列、或者使用复制粘贴来处理文件。
* 编辑模式（insert mode）：可以使用[i，I，o，O，a，A，r，R]进入编辑模式。
* 指令列命令模式（command-line mode）：在一般模式下，输入[:|/|?]三个中任何一个那妞，可以搜索、保存、替换、退出、显示或取消行号等相关操作。

（2）vi使用快捷键说明（只统计常用的，其他请自行google或参考鸟哥Linux私房菜第9章内容）

A、一般指令模式下

快捷键 | 说明
-- | --
/ | 1、快捷移动光标的方法
h / (向左箭头) | 光标向左移动一个字符
j / (向下箭头) | 光标向下移动一个字符
k / (向上箭头) | 光标向上移动一个字符
l / (向右箭头) | 光标向右移动一个字符
crtl + f | 屏幕【向下】移动一页，相当于【Page Down】按键
crtl + b | 屏幕【向上】移动一页，相当于【Page Up】按键
0或功能键【Home】 | 移动到光标所在行的最前面字符处
$或功能键【End】 | 移动到光标所在行的最后面字符处
G | 移动到这个文件的最后一列
gg或1G | 移动到这个文件的第一列
n + 回车 | n表示数字，例如：按下3再回车，表示向下移动3行
/ | 2、搜索与替换
/word | 向下搜索名称为word的字符串
?word | 向上搜索名称为word的字符串
n | 重复前一个搜索动作，常用于搜索完跳到下一个或上一个搜索到的字符串位置
N | 同n相反，例如：向下搜索，使用N之后则为向上进行搜索
:n1,n2s/word1/word2/g | n1、n2均为数字，表示在n1和n2之间进行搜索word1这个字符串并替换为word2字符串
:1,$s/word1/word2/g | 全文搜索并替换
:1,$s/word1/word2/gc | 全文搜索并替换，替换之前需要确认（确认根据提示输入y即可）
/ | 3、删除、复制与粘贴
x / X | x（相当于[del]功能键）向后删除，X向前删除
dd | 删除整行
ndd | n表示数字，删除光标所在行下的n行
yy | 复制光标所在行
nyy | n表示数字，复制光标所在行后的n行
p/P | p将复制的数据粘贴在光标下一行上，P则为从当前行插入，当前行向下顺延，例如从第10行开始粘贴20行数据，则原来的第10行经过粘贴后到第30行。
u | 撤销上一个动作

B、从一般指令模式切换为编辑模式

快捷键 | 说明
-- | --
i,I | 进入插入模式（Insert mode）：<br>i为【从光标所在处插入】，I为【从光标所在行的第一个非空字符处开始插入】
a,A | 进入插入模式（Insert mode）：<br> a为【从光标所在的下一个字符处开始插入】,A为【从光标所在行的最后一个字符处开始插入】
o,O | 进入插入模式（Insert mode）：<br> o为【从光标所在行的下一行进行插入】,O为【从光标所在行的上一行进行插入】
r,R | 进入取代模式Replace mode）：<br> r只会取代光标处的字符1次，R会一直取代光标所在的文字直到按下ESC为止。
ESC | 退出编辑模式，回到一般指令模式

C、一般指令模式切换到指令列模式

快捷键 | 说明
-- | --
:w | 写入到文件
"w! | 当文件为只读属性，强制写入，是否能够写入，与文件的权限有关
:q | 退出vi
:q! | 修改过文件但不想保存，强制离开vi
:wq | 保存
:w [filename] | 将编辑的文件另存为一个新文件

D、vim环境的变更

快捷键 | 说明
-- | --
:set nu | 显示行号
:set nonu | 取消显示行号

（3）vim的暂存、救援回复与开启时的警告讯息

> 当系统因为某些原因而导致类似宕机的情况，vim可以通过【暂存】机制来恢复编辑未保存的数据。

当编辑某个vim，例如:ss.sh，按下`crtl + z`，通过`ls -al`可以看到如`.ss.sh.swp`的暂存文档，这个文档主要记录修改的动作，如果这个时候系统宕机或者通过命令`kill -9 %1`模拟宕机，再打开该文件的时候可以看到提示信息，按照提示信息进行操作即可恢复编辑过未保存的文件。

暂存恢复按钮如下：

恢复操作 | 说明
-- | --
[O]pen Read-Only | 以只读方式打开该文件
(E)dit anyway | 正常编辑
(R)ecover | 恢复编辑但未保存的内容
(D)elete it | 删除暂存盘的内容
(Q)uit | 退出
(A)bort | 退出

##### 9.3 vim的额外功能

第一次打开一个vim文件的时候，在文件的最下方会显示如下信息：
* vim会进行语法检验，不同内容会显示不同的颜色，例如：注释显示为深蓝色
* 文件的最下方【左边】显示该文件的属性，包括行数、字符数，如果为只读，显示只读属性；
* 文件的最下方【右边】显示光标的位置以及光标处在文件的位置，例如：当光标在第一行显示为：1,1 Top，1,1为行列信息，Top为大概的位置信息，可能为Top，20%、Bot登类似信息。






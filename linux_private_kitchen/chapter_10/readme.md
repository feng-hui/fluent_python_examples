#### 第十章 认识与学习BASH

##### 10.1、认识BASH与Shell

1、什么是shell？

shell的功能是提供用户操作的一个接口，用户可以通过shell（指令列模式）来操作应用程序。

2、Bash shell功能？

* 命令编修功能（history，默认记录1000条，当前执行的所有指定暂存在内存中，成功注销之后会记录到.bash_history中）
* 命令和文件补全功能（[tab]键）
    * [Tab] 在一串指令的第一个字的后面，则未命令补全
    * [Tab] 在一串指令的第二个字以后时，则为文件补全
    * 若安装`bash-completion`软件，则在某些指令后面使用[tab]键时，可以进行选项/参数的补全。
* 设置命令别名（alias）
* 工作控制、前景背景控制
* 程序化脚本
* 通配符

3、查询指令是否为内建命令？(type)

```
# 系统不同，查到的结果可能有所不同
# type根据不同的参数可以显示不同的结果，具体可以使用man type来查看

# 1、直接查询
>>> type ll
>>> ll is aliased to `ls -l --color=auto'

>>> type export
>>> export is a shell builtin

>>> type rm
>>> rm is hashed (/bin/rm)

# 2、打印指令的类型(builtin 内建、alias 别名、file 外部指令)

>>> type -t export
>>> builtin

>>> type -t ls
>>> alias

>>> type -t rm
>>> file
```

4、指令的下达与快速编辑按钮

* 指令串过长：`\[Enter]]`(\+回车，中间没有空格，执行完成之后跳到下一行继续输入)
* 快速删除输入的指令：[ctrl]+u/[ctrl]+k（删除光标之前的所有指令串/删除光标之后的所有指令串）
* 快速移动指令串中的光标：[ctrl]+a/[ctrl]+e（光标快速移动到整个指令串的最前面/最后面）

##### 10.2、Shell的变量功能

1、什么是变量?

变量就是以一组文字或符号等，来取代一些设定或是一串保留的数据。

2、变量的取用与设定

获取变量的值：echo $variable 或 echo ${variable}
变量赋值规则：
* 变量与变量内容以一个等号=来连接；
* 等号两边不能直接接空格符；
* 变量名称只能是英文字母或数字，第一个字符不能位数字；
* 变量内若有空格符可以使用双引号或单引号将变量内容包裹起来；
    * 双引号内的特殊字符如$等，可以保有原本的特性；
    * 单引号内的特殊字符则仅为一般字符（纯文本）。
* 可用跳脱符(\)将特殊符号（如[enter]、$、\、空格符、`等）变成一般字符；
* 在一串指令的执行中，可以使用反单引号(`)或$获取其他指令所提供的信息；
* 如果扩展变量内容，则可使用"$变量名称"或$变量累加内容，例如:PATH="$PATH:/home/bin"或PATH=${PATH}:/home/bin;
* 若变量需要在其他子程序执行，则需要以export来使得变量变成环境变量；例如：export PATH;
* 通常大写字符为系统默认变量，自行设定变量可以使用小写字符，方便判断（纯粹依照使用者新区与嗜好）；
* 取消变量的方法使用`unset`：`unset 变量名称`。

3、什么是【子程序】？

在当前shell的情况下，去启用另外一个新的shell，新的shell就是子程序。例如：在当前shell中直接执行`bash`命令就可以到一个子程序中。

4、环境变量的功能

查阅环境变量可以使用`env`或`export`这两个指令。

(1)、env查看环境环境变量以及结果说明

环境变量名称 | 含义
| -- | --
HOME | 用户的家目录
SHELL | 当前环境使用的SHELL程序
HISTSIZE | 历史命令的记录数
MAIL | 使用`mail`指令收信时，系统会读取的邮件信箱文件
PATH | 执行文件搜索的路径(目录与目录之间以:进行分割)
LANG | 系统语言
RANDOM | 随机数(0-32767)

（2）使用`set`查看所有变量（包含环境变量与自定义变量）

`set`除了可以显示环境变量，还可以显示一些与bash操作接口有关的变量以及用户定义的变量。

重要的介绍如下：

环境变量名称 | 含义
| -- | --
PS1 | 提示字符的设定（按下enter键后，光标前的一串文字）
$ | 当前shell的PID
? | 上个指令的回传值（如果成功为0，错误为非0）
OSTYPE/HOSTTYPE/MACHTYPE | 主机硬件与核心的等级

（3）、`export`：将自定义变量转成环境变量

`export 变量名称`，转换成环境变量之后，变量可以被子程序继承。

5、影响显示结果的语系变量(`locale`)

```
# 01 locale
# 查看所有已经设置的语系变量
>>> locale

# 02 locale -a
# 查看所有系统支持的语系
```

如果设定了`LANG`或者`LC_ALL`，则其他语系的变量都会被取代。

6、变量键盘读取、数组与宣告：`read`,`array`,`declare`

（1）`read`

> 读取来自键盘输入的变量。语法如下：

```
# read -pt variable
# -p 提示符
# -t 等待的时间（单位：秒）

>>> read 变量名称
>>> 输入内容
>>> echo $变量名称

>>> read -p '请输入变量内容:' -t 5 变量名称
>>> 输入内容
>>> echo $变量名称
```

（2）`array`

> 定义变量为数组类型。语法如下：

```
# var[index]=content
# var     变量名称
# index   索引值
# content 内容

>>> var[1]='the first value'
>>> var[2]='the second value'
>>> var[3]='the third value'

>>> echo "${var[1]},${var[2]},${var[3]}"
```

（3）`declare`/`typeset`

> 定义变量的类型。

* 如果设置为只读，则不能更改该变量的值；
* 如果想将变量变成环境变量采用`declare -x`，如果想将环境变量变成普通变量采用`declare +x`。

语法如下：

```
# declare [-aixr] variable
# -a 将变量定义为数组（array）类型
# -i 将变量定义为整数数字（integer）类型
# -x 将变量定义为环境变量（同export用法相同）
# -r 将变量定义为只读（readonly）类型

>>> declare
>>> 显示所有的变量名称与内容

# 如果没有-i，输出的为字符串(100+300+500)
# bash环境计算只能达到整数形态，所以1/3的结果为0
>>> declare -i sum=100+300+500
>>> echo $sum
>>> 900
```

7、与文件系统及程序的限制关系：`ulimit`

> 限制用户可以使用的系统资源大小，比如：可以开启的文件数量、可以使用的CPU时间、可以使用的内存大小等。

语法如下：
[只做了解，具体的参数含义可以在自行查看]

```
# ulimit [-SHacdfltu] [配额]

# 列出所有的限制额度
# 如果结果为0，则表示不限制
>>> ulimit -a
```

8、变量内容的删除、取代与替换

（1）变量内容的删除

* 从前到后进行删除
    * `#`  删除符合的最短的数据
    * `##` 删除符合的最长数据
* 从后到前进行删除
    * `%`  删除符合的最短的数据
    * `%%` 删除符合的最长数据

```
# 变量内容的删除

# 从前到后进行删除
# ${变量#/关键词}
# ${变量##/关键词}

# 从后向前进行删除
# ${变量%/关键词}
# ${变量%%/关键词}

>>> path=${PATH}
>>> echo ${path#/*local/bin:}
>>> echo ${path##/*local/bin:}

>>> echo ${path%:*bin}
>>> echo ${path%%:*bin}
```

（2）变量内容的替换

* `/`  替换符合要求的一个字符串
* `//` 替换符合要求的所有字符串

语法如下：
```
# echo ${变量/旧字符串/新字符串}
# echo ${变量//旧字符串/新字符串}

>>> echo ${path/sbin/SBIN}
>>> echo ${path//sbin/SBIN}
```

（3）变量的测试与内容替换


## chapter 14 可迭代的对象、迭代器和生成器

**主要内容**

- [x] 语言内部使用iter(...)内置函数处理可迭代对象的方式

- [x] 如何使用Python实现经典的迭代器模式

- [x] 详细说明生成器函数的工作原理

- [x] 如何使用生成器函数或生成器表达式代替经典的迭代器

- [x] 如何使用标准库通用的生成器函数

- [x] 如何使用yield from 语句合并生成器

- [x] 案例分析：在一个数据库转换工具中使用生成器函数处理大型数据

- [x] 为什么生成器和协程看似相同，实则差别很大，不能混淆

#### 1、序列可以迭代的原因（iter函数）

解释器需要调用迭代对象时，会自动调用iter(x)

内置的iter函数有以下作用：

* （1）检查对象是否实现了`__iter__`方法，如果实现就调用它，获取一个迭代器。

* （2）如果没有实现`__iter__`方法，但是实现了`__getitem__`方法，Python会创建一个迭代器，尝试按顺序（从索引0开始）获取元素。

* （3）如果尝试失败，Python抛出TypeError异常，通常会提示“C object is not iterable”（C对象不可迭代），其中C是目标对象所属类。

#### 2、可迭代对象和迭代器的区别

* 可迭代的对象：使用iter内置函数可以获取迭代器的对象。如果对象实现了能返回迭代器的`__iter__`方法，那么对象是可迭代的。
* 迭代器：Python从可迭代的对象中获取迭代器。标准的迭代器接口有两个方法：
    * `__next__` 返回下一个可用的元素，如果没有元素了，抛出StopIteration异常。
    * `__iter__` 返回`self`，以便在应该使用可迭代对象的地方使用迭代器，例如在for循环中。
* 序列都可以迭代，如果实现了`__getitem__`方法，而且其参数是从零开始的索引，这种对象也是可以迭代的。

#### 3、标准库中的生成器函数

*后续更新*

#### 4、Python 3.3 中新出现的句法： yield from

* 如果生成器函数需要产出另外一个生成器的值，传统的解决方法是使用嵌套的for循环，yield from语法代替了内层的for循环。
* `yield from`除了替代循环之外，还会创建通道，把内层生成器直接与外层生成器的客户端连接起来。
* 把生成器当成协程使用时，这个通道特别重要，不仅能为客户端代码生成值，还能使用客户端代码提供的值。

#### 5、可迭代的归约函数

函数接受一个可迭代对象，然后返回单个结果的函数被称为规约函数或者“合拢”函数或“累加”函数。

*内置规约函数的介绍后续增加*

#### 6、深入分析`iter`函数

（1）介绍一个`iter`函数鲜为人知的用法

常规的使用方法为添加一个参数，参数为常规的函数或任何可迭代对象。